{"version":3,"sources":["../../source/controllers/comments.js"],"names":["comments","express","Router","post","req","res","comment","Comment","body","author","user","_id","savedComment","save","catch","err","console","log","parentPost","Post","findById","unshift","result","User","savedUser","redirect","get","params","commentId","render","reply","savedReply","parentComment","children"],"mappings":"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","sourcesContent":["// comments.js\n\n// app\nimport express from 'express'\nconst comments = express.Router()\n\n// models\nimport Comment from '../models/comment.js'\nimport Post from '../models/post.js'\nimport User from '../models/user.js'\n\n// create comment\ncomments.post(`/`, async (req, res) => {\n    // save the comment to the db\n    const comment = new Comment(req.body);\n    comment.author = req.user._id;\n    const savedComment = await comment.save().catch(err => { console.log(err) });\n    // add it to the parent post\n    const parentPost = await Post.findById(req.body.post).catch(err => { console.log(err) });\n    parentPost.comments.unshift(savedComment);\n    const result = await parentPost.save().catch(err => { console.log(err) });\n    // add it to the user's profile\n    const user = await User.findById(req.user._id).catch(err => { console.log(err) })\n    user.comments.unshift(comment)\n    const savedUser = await user.save().catch(err => { console.log(err) })\n    res.redirect(`/posts/${req.body.post}`);\n})\n\n// get new reply form\ncomments.get(`/:commentId/replies/new`, async (req, res) => {\n    const comment = await Comment.findById(req.params.commentId)\n    res.render(`replies-new`, { comment: comment })\n})\n\n// create reply\ncomments.post(`/:commentId/replies`, async (req, res) => {\n    const reply = new Comment(req.body)\n    reply.author = req.user._id;\n    const savedReply = await reply.save().catch(err => { console.log(err) })\n\n    const parentComment = await Comment.findById(req.params.commentId).catch(err => { console.log(err) })\n    parentComment.children.unshift(savedReply._id)\n    const result = await parentComment.save().catch(err => { console.log(err) })\n\n    res.redirect(`/posts/${req.body.post}`)\n})\n\nexport default comments;\n"],"file":"comments.js"}